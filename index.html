<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="assets/css/reset.css" type="text/css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/style.css" type="text/css">

    <title>Star Wars: Battle Arena</title>
  </head>
  <body>
    <div class="container" id="heading">
        <h1 class="display-5">Star Wars: Battle Arena!</h1>
        <p class="lead" id="marching-orders">Please select a character to begin.</p>
        <hr>
    </div>
    
    <div class="container">
        <div class="row mb-5">
            <div class="col-sm-1">
                <img src="assets/images/boba-fett.png" class="fighter" id="bobaFett" alt="Boba Fett" style="width: 40px; margin: auto auto">
            </div>
            <div class="col-sm-1">
                <img class="fighter" id="c3po" src="assets/images/c3po.png" alt="C-3PO" style="height: 60px">
            </div>
            <div class="col-sm-1">
                <img class="fighter" id="chewbacca" src="assets/images/chewbacca.png" alt="Chewbacca" style="height: 60px">
            </div>
            <div class="col-sm-1">
                <img class="fighter" id="darthMaul" src="assets/images/darth-maul.png" alt="Darth Maul" style="height: 60px">
            </div>
            <div class="col-sm-1">
                <img class="fighter" id="darthVader" src="assets/images/darth-vader.png" alt="Darth Vader" style="height: 60px">
            </div>
            <div class="col-sm-1">
                <img class="fighter" id="hanSolo" src="assets/images/han-solo.png" alt="Han Solo" style="height: 60px">
            </div>
            <div class="col-sm-1">
                <img class="fighter" id="lukeSkywalker" src="assets/images/luke-skywalker.png" alt="Luke Skywalker" style="height: 60px">
            </div>
            <div class="col-sm-1">
                <img class="fighter" id="obiWanKenobi" src="assets/images/obi-wan-kenobi.png" alt="Obi-Wan Kenobi" style="height: 60px">
            </div>
            <div class="col-sm-1">
                <img class="fighter" id="princessLeia" src="assets/images/princess-leia.png" alt="Princess Leia" style="height: 60px">
            </div>
            <div class="col-sm-1">
                <img class="fighter" id="r2d2" src="assets/images/r2d2.png" alt="R2-D2" style="height: 60px">  
            </div>
            <div class="col-sm-1">
                <img class="fighter" id="stormTrooper" src="assets/images/storm-trooper.png" alt="Storm Trooper" style="height: 60px">
            </div>
            <div class="col-sm-1">
                <img class="fighter" id="yoda" src="assets/images/yoda.png" alt="Yoda" style="height: 60px">
            </div>
        </div>
    </div>

    <div class="container mb-5">
        <div class="row" style="height: 375px;">
            <div class="card" id="player1" style="width: 50%;">
                <h5>Choose Your Fighter: </h5>
                <img class="card-img-top" id="player1-img" style="width:120px; margin:auto auto;">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item"><span id="p1">Player 1</span></li>
                    <li class="list-group-item">Health Power: <span id="p1-hp">n/a</span></li>
                    <li class="list-group-item">Attack Power: <span id="p1-ap">n/a</span></li>
                </ul>
            </div>
            <div class="card" id="player2" style="width: 50%;">
                <h5>Choose Your Enemy:</h5>
                <img class="card-img-top" id="player2-img" style="width:120px; margin:auto auto;">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item"><span id="p2">Player 2</span></li>
                    <li class="list-group-item">Health Power: <span id="p2-hp">n/a</span></li>
                    <li class="list-group-item">Attack Power: <span id="p2-ap">n/a</span></li>
                </ul>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-6">
                <button type="button" class="btn btn-primary btn-block" id="atk-btn">Attack</button>
            </div>
        </div>
    </div>

    <div class="overflow-auto fixed-bottom mb-3 card" id="system-alerts" style="height: 150px; width: 100%;"></div>
    
    

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            var p1img = document.getElementById("player1-img");
            var p2img = document.getElementById("player2-img");
            var character = "";

            var characters = {
                bobaFett: {
                    name: "Boba Fett",
                    selected: false,
                    defeated: false,
                    hp: 100,
                    ap: 6,
                    cap: 8,
                },
                c3po: {
                    name: "C-3PO",
                    selected: false,
                    defeated: false,
                    hp: 40,
                    ap: 2,
                    cap: 1,
                },
                chewbacca: {
                    name: "Chewbacca",
                    selected: false,
                    defeated: false,
                    hp: 120,
                    ap: 4,
                    cap: 3,
                },
                darthMaul: {
                    name: "Darth Maul",
                    selected: false,
                    defeated: false,
                    hp: 175,
                    ap: 10,
                    cap: 17,
                },
                darthVader: {
                    name: "Darth Vader",
                    selected: false,
                    defeated: false,
                    hp: 225,
                    ap: 13,
                    cap: 20,
                },
                hanSolo: {
                    name: "Han Solo",
                    selected: false,
                    defeated: false,
                    hp: 90,
                    ap: 7,
                    cap: 6,
                },
                lukeSkywalker: {
                    name: "Luke Skywalker",
                    selected: false,
                    defeated: false,
                    hp: 120,
                    ap: 9,
                    cap: 12,
                },
                obiWanKenobi: {
                    name: "Obi Wan Kenobi",
                    selected: false,
                    defeated: false,
                    hp: 110,
                    ap: 11,
                    cap: 12,
                },
                princessLeia: {
                    name: "Princess Leia",
                    selected: false,
                    defeated: false,
                    hp: 69,
                    ap: 4,
                    cap: 3,
                },
                r2d2: {
                    name: "R2-D2",
                    selected: false,
                    defeated: false,
                    hp: 50,
                    ap: 2,
                    cap: 1,
                },
                stormTrooper: {
                    name: "Storm Trooper",
                    selected: false,
                    defeated: false,
                    hp: 85,
                    ap: 6,
                    cap: 8,
                },
                yoda: {
                    name: "Yoda",
                    selected: false,
                    defeated: false,
                    hp: 65,
                    ap: 15,
                    cap: 10,
                }
            };
            
            var player1 = {
                name: "",
                selected: false,
                hp: 0,
                ap: 0,
                baseAP: 0,
                cap: 0,
                getCharacter: function(obj){
                    this.name = obj.name;
                    this.selected = true;
                    this.hp = obj.hp;
                    this.ap = obj.ap;
                    this.baseAP = obj.ap;
                    this.cap = obj.cap;
                    obj.selected = true;
                    console.log(player1);
                    console.log(obj);
                },
                loadStats: function(){
                    $("#p1-hp").text(this.hp);
                    $("#p1-ap").text(this.ap);
                },
                attack: function(){
                    player2.hp = player2.hp - this.ap;
                    this.ap = this.ap + this.baseAP;
                    player1.loadStats();

                    if (player2.hp > 0) {
                        player2.loadStats();
                        $("#system-alerts").prepend("<span style='color: blue'>>> You attacked the enemy. Their HP is now " + player2.hp + ". Your attack has increased your AP by " + player1.baseAP + " points. Your AP is now " + player1.ap + ". </span>");
                        player2.counterAttack();
                    } else {
                        player2.isDefeated();
                    }
                },
                isAlive: function(){
                    if (this.hp > 0) {
                        return true;
                    } else {
                        return false;
                    }
                }
            }

            var player2 = {
                name:"",
                characterID: "",
                selected: false,
                hp: 0,
                ap: 0,
                cap: 0,
                getCharacter: function(obj){
                    this.characterID = obj
                    this.name = obj.name;
                    this.selected = true;
                    this.hp = obj.hp;
                    this.ap = obj.ap;
                    this.cap = obj.cap;
                    obj.selected = true;
                    console.log(player2);
                    console.log(obj);
                },
                loadStats: function(){
                    $("#p2-hp").text(this.hp);
                    $("#p2-ap").text(this.cap);
                },
                counterAttack: function() {
                    player1.hp = player1.hp - this.cap;
                    player1.loadStats();

                    if (player1.isAlive() === true) {    
                        $("#system-alerts").prepend("<span style='color: red;'>>> The Enemy has counter-attacked. Your HP is now " + player1.hp + ".</span>");
                    } else {
                        $("#system-alerts").prepend("<span style='color: red; font-size: 24px;'>>> The Enemy has delivered a crushing blow as a counter-attack. You have been defeated! Please try again.</span>");
                        $("#atk-btn").text("Try Again!");
                    }
                },
                isDefeated: function() {
                    characters[character]["defeated"] = true;
                    console.log(characters[character]["defeated"]);
                    $("#p2").text("n/a");
                    $("#p2-hp").text("n/a");
                    $("#p2-ap").text("n/a");
                    p2img.src = "";
                    this.name = "";
                    this.selected = false;
                    this.hp = 0;
                    this.ap = 0;
                    this.cap = 0;
                    checkStatus();
                }
            };

            function checkStatus(){
                var defeatedCount = 0;
                var objKeys = Object.keys(characters);
                for (var i = 0; i < objKeys.length; i++) {
                    if (characters[objKeys[i]]["defeated"] === true) {
                        defeatedCount++;
                    }
                }

                if (defeatedCount < (objKeys.length - 1)) {
                    $("#system-alerts").prepend("<span style='color: green;'>>> You have defeated the enemy! May the force be with you. Please choose your next opponent.</span>");
                    return false;
                } else {
                    $("#system-alerts").prepend("<span style='color: green;'>>> You are the master of the multi-verse!</span>");
                    alert("You have defeated all the defenders of the multi-verse! You Win!");
                    $("#atk-btn").text("Try Again!");
                    return true;
                }

            };


            $(".fighter").on("click", function(){
                character = this.id;
                console.log(character);

                if (player1.selected === false) {
                    p1img.src = this.src;

                    player1.getCharacter(characters[character]);
                    $("#p1").text(characters[character]["name"]);
                    $("#system-alerts").prepend("<span style='color: green;'>>> You have selected " + player1.name +" as your fighter.</span>");
                    player1.loadStats();
                    $(this).css("opacity", "0.25");

                } else if (player2.selected === false) {
                    p2img.src = this.src;

                    player2.getCharacter(characters[character]);
                    $("#p2").text(characters[character]["name"]);                  
                    $("#system-alerts").prepend("<span>>> An Enemy has appeared. Prepare to battle!</span>");
                    player2.loadStats();
                    $(this).css("opacity", "0.25");
                } else if (player1.isAlive() === false) {
                    $("#system-alerts").prepend("<span>>> You have been defeated. Please try again!</span>");
                } else {
                    $("#system-alerts").prepend("<span>>> Battle in progress. Defeat your currently enemy before selecting your next opponent.</span>");
                }

            });

            $("#atk-btn").on("click", function() {
                if (player1.selected === true && player2.selected === true){
                    if (player1.isAlive() === true) {
                        player1.attack();
                    } else {
                        location.reload();
                    }
                } else if (checkStatus() === true) {
                    location.reload();
                } else {
                    $("#system-alerts").prepend("<span>>> Please select your opponent to begin the battle.</span>");
                }
            });
        });
    </script>
  </body>
</html>